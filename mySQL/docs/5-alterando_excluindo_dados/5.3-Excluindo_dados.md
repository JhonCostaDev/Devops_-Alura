# Excluindo registros do banco de dados

```SQL
DELETE FROM hospedagens
```


É fundamental lembrar que, ao trabalhar com comandos que modificam a estrutura do banco de dados, como DELETE, ALTER TABLE e UPDATE, é necessário incluir uma cláusula WHERE para especificar em quais registros da tabela queremos realizar essa modificação. Isso evita o risco de excluir ou alterar registros incorretos.

Além disso, é extremamente importante fazer o backup do banco de dados antes de executar qualquer modificação. Isso garante que, em caso de problemas, tenhamos uma versão anterior do banco de dados para restaurar e evitar possíveis danos, especialmente em ambientes de produção.

Vamos adicionar a cláusula WHERE para determinar a condição de exclusão dos registros. A Insight Places forneceu os IDs das hospedagens a serem excluídas: 10000 e 1001. Vamos inserir esses IDs na condição, utilizando a coluna hospedagem_id.

```SQL
DELETE FROM hospedagens
WHERE hospedagem_id IN ('10000', '1001');
```
Retorno omitido.


Ao executar nosso comando, recebemos um erro. Ao investigar, descobrimos que o erro ocorreu devido à existência de uma chave estrangeira relacionada à tabela de avaliações. Isso significa que não podemos excluir essas hospedagens da tabela de hospedagens porque existem registros vinculados a elas na tabela de avaliações.

## Excluindo registros em tabelas relacionadas

Quando há uma relação entre as informações em diferentes tabelas e existe uma restrição de exclusão, não podemos simplesmente excluir registros de uma tabela sem considerar as outras tabelas relacionadas. Por exemplo, não faria sentido ter uma avaliação de um imóvel na tabela de avaliações se essa hospedagem não existir mais no banco de dados.

Para resolver esse problema, precisamos aplicar o comando DELETE também na tabela de avaliações. Vamos manter a consulta atual e adicionar o DELETE da tabela de avaliações antes da tabela de hospedagens, pois é como uma ordem de operações: primeiro excluímos da tabela de avaliações e depois da tabela de hospedagens.

Vamos escrever o DELETE FROM para a tabela de avaliações, que é avaliacoes, e vamos utilizar a mesma condição que utilizamos para a tabela de hospedagens, ou seja, WHERE hospedagem_id IN ('10000', '1001');, pois queremos excluir os mesmos dados.

```SQL
DELETE FROM avaliacoes
WHERE hospedagem_id IN ('10000', '1001');
```

Vamos rodar essa consulta primeiro e, se observarmos abaixo no histórico, veremos que a consulta foi executada com sucesso.

Agora, vamos executar a segunda consulta, que é para excluir da tabela de hospedagens.

```SQL
DELETE FROM hospedagens
WHERE hospedagem_id IN ('10000', '1001');
```

Se observarmos novamente, teremos o mesmo erro de chave estrangeira, pois também precisamos excluir da tabela de reservas.

É importante analisar os erros que ocorrem nas consultas, pois isso nos ajuda a identificar possíveis problemas e corrigi-los. Se surgir um erro, podemos copiar a mensagem de erro, jogá-la no Google para traduzi-la e entender exatamente o que está errado.

Vamos repetir o mesmo processo agora para a tabela de reservas:

```SQL
DELETE FROM reservas
WHERE hospedagem_id IN ('10000', '1001');
```

Vamos executar essa consulta apenas para garantir que está funcionando corretamente. Em seguida, podemos executar a consulta para a tabela de hospedagens.

```SQL
DELETE FROM hospedagens
WHERE hospedagem_id IN ('10000', '1001');
```

Ao executar a consulta para a tabela de hospedagens, veremos que agora foi bem-sucedida.

Dessa forma, conseguimos remover os registros 10000 e 1001 das tabelas de reservas, avaliações e hospedagens, garantindo que o banco de dados esteja limpo e consistente.

## Diferença entre DELETE e DROP
Com isso, compreendemos o uso correto do comando DELETE. É importante ressaltar que este comando serve apenas para remover dados inseridos na tabela, ou seja, registros contidos dentro dela. Quando desejamos eliminar a estrutura da tabela ou até mesmo o banco de dados, utilizamos o comando DROP. Lembre-se de que anteriormente já havíamos utilizado o DROP SCHEMA no início do curso, quando criamos o banco de dados de teste.

Portanto, quando queremos excluir completamente a estrutura de uma tabela ou até mesmo de um banco de dados inteiro, o comando a ser usado é o DROP. A utilização dele é da seguinte forma:

Para apagar um banco de dados completo, utilizamos DROP SCHEMA ou DROP DATABASE, que são sinônimos, seguidos do nome do banco de dados a ser removido;
No caso de uma tabela, utilizamos DROP TABLE, seguido pelo nome da tabela a ser excluída. É fundamental compreender a diferença entre DELETE e DROP, bem como saber quando e como utilizar cada um!
Conclusão e próximos passos
Agora, concluímos com sucesso todas as demandas trazidas pela Insight Places. Realizamos consultas, modificações estruturais e alcançamos nossos objetivos neste projeto em parceria com a Insight Places.


## Para saber mais: conhecendo o comando DELETE e suas restrições

No MySQL, assim como em outros sistemas de gerenciamento de banco de dados relacional (SGBDR), deletar dados de tabelas é uma operação comum, mas que deve ser realizada com cuidado devido às potenciais implicações na integridade dos dados e nas relações entre tabelas. O comando DELETE é utilizado para remover registros de uma ou mais tabelas, e seu uso pode ser diretamente influenciado por restrições definidas no esquema do banco de dados, particularmente as restrições de chave estrangeira.

### Comando DELETE no MySQL

O comando DELETE permite remover registros específicos de uma tabela baseando-se em condições especificadas. A sintaxe básica é:

```SQL
DELETE FROM nome_tabela WHERE condição;
```

Se a condição especificada no WHERE for omitida, todos os registros da tabela serão deletados. É fundamental utilizar a cláusula WHERE para evitar a remoção acidental de mais dados do que o pretendido.

### Restrições de Chave Estrangeira

As restrições de chave estrangeira desempenham um papel crucial na manutenção da integridade referencial entre tabelas em um banco de dados relacional. Uma restrição de chave estrangeira é uma regra aplicada a uma coluna ou conjunto de colunas que identifica a chave primária de outra tabela. Essa restrição garante que o valor da chave estrangeira sempre aponte para um registro válido na tabela referenciada ou seja **NULL**.


### Impacto nas Operações DELETE

Quando você tenta deletar um registro que está sendo referenciado por uma chave estrangeira em outra tabela, o MySQL verifica as restrições de chave estrangeira para determinar se a operação é permitida. O comportamento padrão é impedir a exclusão se o registro a ser deletado for referenciado por uma chave estrangeira em outra tabela, a menos que tenha sido configurado de outra forma. Existem várias estratégias para lidar com esse cenário:


* **RESTRICT:** Impede a exclusão do registro na tabela pai se existirem registros relacionados na tabela filha. Esta é a configuração padrão.
* **CASCADE:** Ao deletar um registro na tabela pai, todos os registros relacionados na tabela filha também são deletados automaticamente.
* **SET NULL**: Ao deletar um registro na tabela pai, os valores das chaves estrangeiras nos registros relacionados da tabela filha são definidos como NULL.
* **NO ACTION**: Semelhante a RESTRICT, mas a verificação é adiada até o final da transação.


### Utilizações Práticas do DELETE

O comando **DELETE** é frequentemente utilizado para:

* Remover registros obsoletos ou irrelevantes para liberar espaço e manter a relevância dos dados.
* Limpar dados de teste em ambientes de desenvolvimento ou teste antes de executar novos testes.
* Implementar funcionalidades de "exclusão" em aplicações, permitindo aos usuários remover registros específicos, como posts em um blog ou contas de usuário.

Ao utilizar o comando **DELETE**, é crucial considerar as implicações nas restrições de chave estrangeira para evitar erros de integridade referencial e garantir que os dados permaneçam consistentes. Recomenda-se sempre verificar as relações entre as tabelas antes de realizar operações de exclusão e considerar o impacto dessas operações em toda a base de dados. Em ambientes de produção, é prudente realizar backups dos dados antes de executar comandos DELETE significativos, para facilitar a recuperação de dados em caso de exclusão acidental ou outros imprevistos.

