## Identificando propriedades mais ativas

Vamos começar estruturando nossa consulta. A primeira coisa que precisamos pensar é como trazer essa informação. Precisamos entender que a empresa gostaria de saber informações dessas pessoas e quantas hospedagens ativas cada uma tem.

Cada uma dessas informações está contida em tabelas diferentes. As informações das hospedagens ativas estão na tabela de hospedagens, já as informações dos nomes das pessoas proprietárias estão na tabela de proprietarios.

Portanto, precisamos fazer uma consulta que junte informações das tabelas hospedagens e proprietarios.

Vamos entender melhor estruturando passo a passo a consulta. Vamos começar fazendo um SELECT na coluna de nome da tabela de proprietario.

Vamos criar um alias (apelido) para cada coluna de cada tabela. Além do nome da coluna normal, vamos colocar para as colunas pertencentes à tabela de proprietários o p. e para as colunas pertencentes à tabela de hospedagens o h.. Dessa forma, vamos identificar de qual tabela é cada coluna.

Vamos começar colocando aqui p.nome. Queremos trazer a coluna de nome das pessoas proprietárias, mas vamos dar um alias para ela aparecer na hora que trouxermos os resultados com um nome mais compreensível. Assim, escrevemos AS nome_proprietario.

Vamos colocar uma vírgula e agora vamos colocar a função COUNT. Entre parênteses, vamos colocar para contar o ID das hospedagens. Assim, vamos saber a quantos IDs de hospedagem cada proprietário está vinculado. A partir daí, vamos conseguir saber quantas hospedagens estão vinculadas para cada proprietário.

Como vamos trazer hospedagem_id da tabela de hospedagens, temos que colocar o h.. Então, h.hospedagem_id. Vamos colocar para trazer essa informação como AS total_hospedagens_ativas. De onde vamos trazer essas informações? Vamos trazer da tabela de proprietários, então FROM proprietarios p.

Vamos continuar nossa consulta. Agora, vamos fazer um JOIN, para juntar agora a tabela de proprietários com a tabela de hospedagens, porque elas vão ter informações que vão se encontrar. Isso vai realmente trazer essa questão da coluna de ativo, para sabermos quais são os imóveis ativos de cada proprietário.

Como vamos fazer isso? Vamos colocar JOIN hospedagens h. Agora vamos colocar ON. Esse ON é para significar onde o JOIN vai ser feito. Então, qual coluna que ele vai trazer para unir.

Então, vamos colocar ON p.proprietario_id = h.proprietario_id. vamos fazer a junção, o JOIN dessa coluna de id do proprietário que tem nas duas tabelas.

Vamos colocar também uma cláusula WHERE, WHERE h.ativo = 1. Vamos também agrupar pelo nome dos proprietários com group by p.nome. Vamos ordenar pelo total de hospedagens de forma decrescente, porque queremos saber o top 10, os 10 proprietários que mais têm hospedagens ativas na plataforma.

Então, vamos ordenar dos que têm mais hospedagens, do maior número de hospedagens ativas classificados, para o menor. Então, como fazemos isso? Vamos ordenar pelo total de hospedagens ativas, que foi o que já determinamos no começo da consulta, com uma contagem do id de hospedagens por proprietário, e essa coluna vai se chamar total_hospedagens_ativas.

Então, vamos ordenar por ela. ORDER BY total_hospedagens_ativas DESC, que vai ser do maior para o menor, decrescente.

Por último, a empresa pediu para ver apenas os 10 primeiros proprietários. Então, vamos limitar o número de registros dessa consulta exatamente por 10 registros, que são os 10 proprietários que mais têm hospedagens cadastradas. Então, colocamos LIMIT 10. Vamos colocar ponto e vírgula e rodar agora a nossa consulta.

```sql

SELECT p.nome AS nome_proprietario, COUNT(h.hospedagem_id) AS total_hospedagens_ativas
FROM proprietarios p
JOIN hospedagens h ON p.proprietario_id = h.proprietario_id
WHERE h.ativo = 1
GROUP BY p.nome
ORDER BY total_hospedagens_ativas DESC
LIMIT 10;
```

Agora, se analisarmos o resultado, temos os top 10 proprietários com mais hospedagens ativas atualmente na plataforma, em uma tabela similar a que aparece abaixo.

      nome_proprietario	  total_hospedagens_ativas
      Thiago Porto	                3
      Vinícius Nogueira	            3
      João Gabriel Ramos	          3
      Miguel Silva	                3
      Pedro da Mata	                3

Assim, a **Insight Places** pode pegar o nome dessas pessoas, entrar em contato com elas, fazer uma aproximação, saber como pode ajudar essas pessoas a cadastrar mais hospedagens ainda na plataforma. Enfim, isso vai ajudar a alavancar o negócio da empresa.

Assim como a empresa queria saber os proprietários que mais têm hospedagens ativas, ela tem interesse em saber os proprietários que têm muitas hospedagens inativas na plataforma.

Com isso, ela vai poder entrar em contato e entender o que está acontecendo, se a pessoa ainda tem interesse em continuar na plataforma, se deseja descadastrar o imóvel e deixar somente quem tem interesse mesmo em continuar com o imóvel na plataforma.

## Identificando hospedagens inativas
Então, como podemos encontrar esse número de hospedagens inativas por proprietário? Vamos entender como podemos fazer isso.

Vamos novamente na parte superior esquerda da nossa interface do MySQL para abrir uma nova aba de consulta e começar a estruturar essa outra consulta.

Vamos começar pelo SELECT. Vamos usar uma estrutura parecida com a consulta anterior, então, p.nome AS nome_proprietario. Então, como já explicamos cada detalhe da consulta anterior, as coisas que forem parecidas, vamos escrevendo com mais rapidez, e os detalhes que forem diferentes, vamos explicar com calma.

Vamos colocar um COUNT(*) AS total_hospedagens_inativas. Vamos colocar FROM para trazer da tabela de proprietários, o p, para identificar que tudo que estamos escrevendo p. é dessa tabela que vamos trazer.

Agora vamos colocar o nosso JOIN para juntar com a tabela de hospedagens, porque ainda precisamos da informação da coluna de ativo ou inativo que está nessa tabela.

Então, vamos colocar a tabela de hospedagens, e colocamos h na frente para identificar que tudo que vier dessa tabela vamos identificar com um h.. Vamos colocar o ON para entender por onde vai fazer essa junção do JOIN, p.proprietario_id = h.proprietario_id.

Vamos colocar a nossa cláusula WHERE, então, WHERE h.ativo = 0. Então, nesse caso, são os inativos. Falamos desse tipo de dado, que 1 significava ativo e 0 significava inativo. Vamos agrupar GROUP BY p.nome. Vamos dar ponto e vírgula e rodar nossa consulta.

```sql 
SELECT p.nome AS nome_proprietario, COUNT(*) AS total_hospedagens_inativas
FROM proprietarios p
JOIN hospedagens h ON p.proprietario_id = h.proprietario_id
WHERE h.ativo = 0
GROUP BY p.nome;
```

Analisando os resultados, temos o total de hospedagens inativas por proprietário. Não limitamos o número de registros, porque a Insight Places quer entender quanto cada proprietário tem de hospedagem inativa.

Ela vai entrar em contato com as pessoas que possuem maior número, então, tem alguns com 3 hospedagens inativas, a maioria tem 1, mas tem aqui uma Clarice com 5 hospedagens inativas, então, ela com certeza vai entrar em contato, mas ela pode ir entrando em contato de acordo com a necessidade da empresa.

      nome_proprietario	          total_hospedagens_inativas
      Luna Fernandes	                    1
      Ana Júlia Nunes	                    2
      Rebeca Viana	                      1
      Dr. Emanuel da Conceição            1
      Olívia Cardoso	                    1
...	...
Importante também entender de modo detalhado cada demanda que a empresa traz para nós, porque, às vezes, trazemos à consulta uma coisa que a empresa não pediu e não quer saber.

A empresa detalha muito bem o que ela quer realmente de informação, se fizermos as perguntas certas.

Temos que trazer apenas aquilo que a empresa quer, porque ela sabe como pretende usar os dados.

Agora que já conseguimos explorar bastante essa parte dos pro

## Utilizando JOIN
O comando JOIN na linguagem SQL é uma poderosa ferramenta usada para combinar linhas de duas ou mais tabelas, baseando-se em uma coluna relacionada entre elas. Isso permite que realizemos consultas complexas e extraímos informações significativas que estão distribuídas em diferentes tabelas de um banco de dados relacional. O JOIN é fundamental para operações que envolvem a manipulação de dados relacionais, oferecendo flexibilidade e eficiência no acesso e na combinação de dados.

### Como Funciona
O JOIN conecta linhas de duas tabelas criando um conjunto de resultados que inclui todas as colunas das tabelas envolvidas. O tipo mais comum de JOIN é o INNER JOIN, que retorna apenas as linhas que têm correspondência em ambas as tabelas. Além do INNER JOIN, existem outros tipos, como LEFT JOIN, RIGHT JOIN, e FULL OUTER JOIN, cada um com uma maneira específica de tratar a inclusão de linhas sem correspondência.

### Características e Tipos de JOIN
  * **INNER JOIN**: Retorna linhas quando há pelo menos uma correspondência em ambas as tabelas.

  * **LEFT JOIN** (ou LEFT OUTER JOIN): Retorna todas as linhas da tabela à esquerda e as linhas correspondentes da tabela à direita. Se não houver correspondência, o resultado é NULL no lado direito.
  
  * **RIGHT JOIN** (ou RIGHT OUTER JOIN): O inverso do LEFT JOIN, retorna todas as linhas da tabela à direita e as correspondentes da tabela à esquerda.

  * **FULL OUTER JOIN**: Combina LEFT JOIN e RIGHT JOIN, retornando todas as linhas quando há uma correspondência em uma das tabelas.

## Quando Utilizar
O JOIN é utilizado em diversas situações, como:

Para combinar dados relacionados armazenados em tabelas separadas, como clientes e pedidos, onde cada pedido está associado a um cliente específico.
Para realizar análises complexas que requerem a combinação de informações de múltiplas fontes de dados.
Para enriquecer conjuntos de resultados com informações adicionais de tabelas relacionadas, melhorando a compreensão e a utilidade dos dados.

## Particularidades no MySQL
No MySQL, o uso do JOIN segue os princípios padrões do SQL, mas com algumas particularidades que valem a pena destacar:

*Performance*: O MySQL otimiza automaticamente as consultas com JOIN, mas o desempenho pode ser afetado pela estrutura das tabelas, índices, e pela complexidade da consulta. É essencial garantir que as colunas usadas para o JOIN estejam indexadas.

*Sintaxe de Alias*: O MySQL permite o uso de aliases para tabelas e colunas nas consultas com JOIN, o que pode simplificar a consulta e melhorar a legibilidade, especialmente quando as tabelas ou colunas têm nomes longos ou quando a mesma tabela é usada múltiplas vezes na consulta.

Tipo de JOIN: Embora o FULL OUTER JOIN não seja diretamente suportado pelo MySQL, é possível simular esse comportamento combinando LEFT JOIN e RIGHT JOIN com UNION.
O comando JOIN é uma ferramenta essencial na caixa de ferramentas de qualquer pessoa que trabalha com bancos de dados relacionais, especialmente no MySQL. Ele fornece a flexibilidade necessária para realizar consultas complexas e extrair o máximo de valor dos dados relacionais, suportando uma ampla gama de cenários de uso. Entender como e quando usar cada tipo de JOIN pode melhorar significativamente a eficiência e a eficácia das operações de banco de dados.