# Salvando os dados da analise
Anteriormente, extraímos alguns valores numéricos a respeito dos nossos arquivos de logs para realizar uma análise e armazenamos esses valores em variáveis. A seguir, vamos aprender como salvar essas informações em outro arquivo.
Salvando dados com echo

Com o monitoramento-logs.sh aberto, temos as variáveis num_palavras e num_linhas ao final do script. Queremos pegar os valores armazenados nessas variáveis e salvá-los em um arquivo para manter esse histórico. Assim, conforme formos acumulando arquivos com esses valores, poderemos analisar e observar o que está acontecendo ao longo do tempo com os logs da nossa aplicação.

Como podemos pegar o valor de uma variável e passá-lo para um arquivo? Já conhecemos o comando echo, que serve para imprimir e exibir uma mensagem no terminal, mas ele também pode ser utilizado para escrever informações em arquivos. A seguir, vamos aprender como utilizá-lo.

No modo de inserção do editor de texto, ainda dentro do laço de repetição, vamos digitar echo e colocar uma mensagem entre aspas. O primeiro item que vamos salvar será o nome do arquivo de logs de onde estamos tirando essas informações. Logo, vamos escrever "Arquivo:" seguido do nome da variável que armazena o nome do nosso arquivo, ${arquivo}.unico:

# ...

    num_palavras=$(wc -w < "${arquivo}.unico")
    num_linhas=$(wc -l < "${arquivo}.unico")

    echo "Arquivo: ${arquivo}.unico"
done

Assim, na primeira linha, teremos o nome do nosso arquivo.

Para redirecionar essa mensagem para outro arquivo, utilizaremos o operador de redirecionamento >>. Dessa forma, não vamos sobrescrever informações enquanto o nosso laço estiver rodando, pois criaremos um único arquivo que armazenará os valores de todos os arquivos de log que tivermos naquela pasta. Chamaremos esse arquivo de log-stats.txt:

# ... 

    num_palavras=$(wc -w < "${arquivo}.unico")
    num_linhas=$(wc -l < "${arquivo}.unico")

    echo "Arquivo: ${arquivo}.unico" >> log_stats.txt
done

    A palavra "stats" é uma abreviação de estatísticas, muito comum para indicar dados estatísticos.

Na sequência, vamos colocar mais um comando echo e escrever a mensagem "Número de linhas:", chamando então a variável ${num_linhas}. Em seguida, também passaremos essa mensagem para o arquivo log-stats.txt:

# ...

    echo "Arquivo: ${arquivo}.unico" >> log_stats.txt
    echo "Número de linhas: $num_linhas" >> log_stats.txt
done

Repetiremos o processo para o número de palavras:

# ...

    echo "Arquivo: ${arquivo}.unico" >> log_stats.txt
    echo "Número de linhas: $num_linhas" >> log_stats.txt
    echo "Número de palavras: $num_palavras" >> log_stats.txt
done

Por fim, podemos escrever um echo e colocar vários traços para fazer uma separação dentro do arquivo, tornando-o visualmente mais organizado. Assim, saberemos onde começam e terminam as informações de um arquivo:

# ...

    echo "Arquivo: ${arquivo}.unico" >> log_stats.txt
    echo "Número de linhas: $num_linhas" >> log_stats.txt
    echo "Número de palavras: $num_palavras" >> log_stats.txt
    echo "--------------------------" >> log_stats.txt
done

Vamos salvar o nosso arquivo com :wq e executar o script:

./monitoramento_logs.sh

Rodaremos um ls dentro desse diretório e notaremos que o arquivo log-stats.txt foi criado. Para conferir seu conteúdo, executaremos:

cat log_stats.txt

O retorno será:

    Arquivo: ../myapp/logs/myapp-frontend.log.unico

    Número de linhas: 11

    Número de palavras: 117

    ---------------------

    Arquivo: ../myapp/logs/myapp-backend.log.unico

    Número de linhas: 18

    Número de palavras: 153

    ---------------------

Na primeira linha, temos o nome do arquivo myapp-frontend.log.unico. Nas duas próximas linhas, é possível checar os dados referentes a ele. Depois, temos o arquivo myapp-backend.log.unico e seus valores.

Note que o sistema mostra todo o caminho para o arquivo, por exemplo, ../myapp/logs/myapp-frontend.log.unico. Para deixar isso visualmente mais organizado, podemos utilizar somente o nome do arquivo.
Extraindo o nome do arquivo com basename

Vamos abrir novamente o monitoramento-logs.sh e extrair apenas o nome dos arquivos. Abaixo de num_linhas, criaremos uma nova variável chamada nome_arquivo, que armazenará o nome do nosso arquivo.

No Linux, temos o comando basename, que extrai somente o nome de um arquivo, sem trazer todo o caminho. Como é um comando, precisamos usar a estrutura $():

# ...

    num_palavras=$(wc -w < "${arquivo}.unico")
    num_linhas=$(wc -l < "${arquivo}.unico")

    nome_arquivo=$(basename "${arquivo}.unico")

    echo "Arquivo: ${arquivo}.unico" >> log_stats.txt
    echo "Número de linhas: $num_linhas" >> log_stats.txt
    echo "Número de palavras: $num_palavras" >> log_stats.txt
    echo "--------------------------" >> log_stats.txt
done

Em seguida, vamos alterar o primeiro echo. Em vez de chamar a variável ${arquivo}.unico, chamaremos ${nome_arquivo}:

# ...

    num_palavras=$(wc -w < "${arquivo}.unico")
    num_linhas=$(wc -l < "${arquivo}.unico")

    nome_arquivo=$(basename "${arquivo}.unico")

    echo "Arquivo: $nome_arquivo" >> log_stats.txt
    echo "Número de linhas: $num_linhas" >> log_stats.txt
    echo "Número de palavras: $num_palavras" >> log_stats.txt
    echo "--------------------------" >> log_stats.txt
done

Podemos salvar o script e sair do editor. Antes de executá-lo, vamos deletar o arquivo de log-stats.txt para não termos informações repetidas. No terminal, rodaremos:

rm log_stats.txt

Uma vez deletado, vamos executar o script:

./monitoramento-logs.sh

Agora, usaremos o cat para checar o conteúdo do arquivo de estatísticas:

cat log_stats.txt

O retorno será:

    Arquivo: myapp-frontend.log.unico

    Número de linhas: 11

    Número de palavras: 117

    ---------------------

    Arquivo: myapp-backend.log.unico

    Número de linhas: 18

    Número de palavras: 153

    ---------------------

Agora, temos um arquivo bem mais organizado, trazendo somente o nome dos nossos arquivos.

Na sequência, vamos aprender como concatenar esses arquivos de log, já que estamos armazenando em arquivos distintos, para mantermos os nossos logs em um único arquivo centralizado.