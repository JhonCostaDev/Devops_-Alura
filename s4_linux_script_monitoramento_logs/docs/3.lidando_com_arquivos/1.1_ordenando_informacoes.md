# Ordenando informações em arquivos
No nosso script de processamento de logs, separamos em um arquivo de logs filtrados as informações sobre erros e dados sensíveis. No entanto, ao adicionar essas informações, os dados ficaram desordenados em relação à data.

É importante manter essa ordenação cronológica para termos uma visão temporal do que ocorre na aplicação, o que nos ajudará a identificar padrões, como picos de erros específicos em determinados horários ou datas, e facilitará futuras análises.

## Ordenando informações com sort

Vamos ordenar o arquivo. No terminal, acessaremos a pasta com os logs usando o comando cd myapp/logs. Podemos visualizar o arquivo de logs filtrados com cat myapp-backend.log.filtrado e perceber que as datas estão desordenadas.

Por exemplo, a data `2024-09-01` aparece no início, `2024-09-03` no meio e `2024-09-02` no final. Não queremos que o arquivo permaneça assim. Para ordenar no Linux, utilizamos o comando sort, que organiza dados de um arquivo. No terminal, digitaremos:

```bash
sort myapp-backend.log.filtrado
```
A saída agora mostra os dados ordenados por data e horário.

O comando sort é simples e poderoso, ordenando por ordem alfabética, do menor para o maior. Ele possui várias opções para personalizar seu comportamento, conforme necessário.

Por exemplo, podemos inverter a ordem para que a data mais recente apareça primeiro, usando a opção -r (reverse):
```bash
sort -r myapp-backend.log.filtrado
```
A saída agora mostra os dados da data mais recente para a mais antiga.

É importante notar que o sort não altera o arquivo original, apenas a saída. Para salvar os dados ordenados em um arquivo, usamos a opção -o seguida do nome do arquivo em que queremos salvar:
```bash
sort myapp-backend.log.filtrado -o logs-ordenados
```
Após executar o comando, um arquivo com os dados ordenados será criado. Rodando ls, verificamos que o arquivo logs-ordenados existe na pasta, então podemos usar o cat para checar seu conteúdo:
```bash
cat logs-ordenados
```
Assim, temos nossas informações salvas e ordenadas como precisamos.

## Incrementando o script de monitoramento

Portanto, vamos inserir esse comando em nosso script. Após abrir o script monitoramento-logs.sh com o Vim, vamos habilitar a edição.

Antes do comando done, podemos inserir o comando sort com a opção -o, substituindo myapp-backend.log.filtrado e logs-ordenados pela variável ${arquivo}.filtrado:

```bash
#!/bin/bash

LOG_DIR="../myapp/logs"

echo "Verificando logs no diretorio $LOG_DIR"

find $LOG_DIR -name "*.log" -print0 | while IFS= read -r -d '' arquivo; do
    grep "ERROR" "$arquivo" > "${arquivo}.filtrado"
    grep "SENSITIVE_DATA" "$arquivo" >> "${arquivo}.filtrado"

    sed -i 's/User password is .*/User password is REDACTED/g' "${arquivo}.filtrado"
    sed -i 's/User password reset request with token .*/User password reset request with token REDACTED/g' "${arquivo}.filtrado"
    sed -i 's/API key leaked: .*/API key leaked: REDACTED/g' "${arquivo}.filtrado"
    sed -i 's/User credit card last four digits: .*/User credit card last four digits: REDACTED/g' "${arquivo}.filtrado"
    sed -i 's/User session initiated with token: .*/User session initiated with token: REDACTED/g' "${arquivo}.filtrado"

    sort "${arquivo}.filtrado" -o "${arquivo}.filtrado"
done
```
Dessa forma, o sort sobrescreve o conteúdo do arquivo de logs filtrados com os dados ordenados.

Vamos salvar as alterações no Vim, pressionando "Esc" e depois :wq. Em seguida, executaremos o script com:
```bash
./monitoramento-logs.sh
```
Após acessar novamente a pasta de logs, verificaremos com cat myapp-backend.log.filtrado que o arquivo está ordenado por data.

Aprendemos a ordenar arquivos com sort, o que nos proporciona uma visão temporal da aplicação e auxilia nas modificações futuras no código.

## Question - Ordenando registros de venda
Na "Meu Pequeno Grimório", uma loja especializada em livros de literatura fantástica e esotérica, você está encarregado de prever a demanda por livros com base nos registros de vendas, que está armazenada no arquivo registros-vendas. No entanto, esses registros estão desordenados, dificultando a análise de tendências de compra.

Como usar o comando sort para ordenar e salvar em um arquivo os registros de venda organizados cronologicamente, para facilitar a análise?