# Criando um script no Linux

Nós temos os arquivos de log de uma aplicação, que trazem registros importantes sobre atividades, erros e eventos que ocorrem dentro da nossa aplicação.

Arquivos de exemplo para estudo do módulo estão presentes na pasta `myApps/logs`.

## Processamento de logs

Como os arquivos de log contêm informações relevantes sobre o estado e a saúde da aplicação, é interessante monitorá-los. No Linux, existem comandos úteis para processar esses logs, extraindo informações como erros e dados sensíveis que possam ter vazado, permitindo solucionar problemas na aplicação.

Esse processamento de logs segue uma série de instruções e comandos repetitivos. Em vez de digitar esses comandos manualmente no terminal toda vez que quisermos processar um arquivo de log, podemos consumir essas instruções de forma automática.

No Linux, há um recurso interessante para isso: os scripts. Vamos criar um script para monitorar nossos logs.

## Criando um script

Com o terminal aberto, primeiramente, criaremos uma pasta para armazenar nosso script. Executamos o seguinte comando:
```bash
mkdir scripts-linux
```
Em seguida, vamos entra na pasta, com o seguinte comando:
```bash
cd scripts-linux
```
Precisamos de um editor de texto para criar o script.

No curso anterior, aprendemos a usar o `Nano` no Linux, mas ele não é a única opção disponível. É interessante conhecer diversos editores de texto, pois cada um possui recursos diferentes, pontos positivos e negativos dependendo da situação.

Caso não haja um motivo específico para usar determinado editor, podemos escolher de acordo com nossas preferências. Neste curso, utilizaremos o `Vim`, outro editor de texto disponível nos sistemas Linux.

Para criar um arquivo e nosso script com o Vim, digitamos no terminal o comando vim seguido do nome do arquivo, que será nosso script. A `.sh` indicará que se trata de um script Bash, um script de Shell do Linux:
```bash
vim monitoramento-logs.sh
```
Para abrir o editor de texto e criar o arquivo, basta pressionar a tecla "Enter". O arquivo vazio será aberto.

Para habilitar a edição de texto no Vim, pressionamos a tecla `"I"` do teclado, entrando no modo de inserção (insert mode), indicado pela palavra `"INSERT"` na parte inferior esquerda do editor.

Um script é um tipo de código. Utilizaremos o script do tipo Bash, que oferece funcionalidades básicas de programação e suporte a comandos Linux executados no terminal.

Um script Bash possui uma estrutura. Além da extensão `.sh`, precisamos especificar algumas informações para indicar que se trata de um script.

A primeira linha que adicionamos é chamada de `shebang`, começando com `#!`, seguido do caminho para o interpretador que executará o código. Como é um script Bash, utilizaremos o Bash como interpretador, logo:
```bash
#!/bin/bash
```
Os scripts podem ser escritos em diversas linguagens, como `Python`. Dependendo da linguagem escolhida, muda-se o caminho para o interpretador utilizado.

Agora que configuramos o necessário, podemos pular uma linha e começar a escrever nosso script e adicionar funcionalidades para processar e monitorar os arquivos de log.

## Escrevendo o script

A primeira ação no script é criar uma variável que armazenará o diretório onde estão nossos logs. Uma variável é um recurso no código para armazenar informações. Neste caso, o diretório de logs.

A variável será chamada `LOG_DIR`. Para atribuir um valor, usamos o sinal de igual. O valor deve ser escrito entre aspas duplas:
```bash
LOG_DIR=" "
```
Começamos o caminho com .., que indica que vamos sair da pasta atual. Em seguida, /my_app/logs, que é a pasta criada na atividade de preparação do ambiente:
```bash
LOG_DIR="../myapp/logs"
```
As aspas duplas são opcionais ao atribuir valores a uma variável, mas é uma boa prática usá-las para evitar problemas com caracteres especiais.

Outra funcionalidade do script é exibir uma mensagem na tela. Para isso, usamos o comando echo do Linux, que nos permite escrever uma mensagem entre aspas duplas.

Vamos escrever `"Verificando logs no diretório"` e, em seguida, queremos indicar qual é esse diretório. Como já temos o diretório salvo na variável LOG_DIR, utilizaremos o valor armazenado nela. No script Bash, chamamos a variável usando o sinal de dólar ($) seguido do nome da variável, portanto:
```bash
echo "Verificando logs no diretorio $LOG_DIR"
```
Assim, essa mensagem será exibida na tela, quando o script for executado.

Para salvar as alterações no arquivo usando o Vim, é preciso sair do modo de inserção pressionando a tecla "Esc". Assim, entramos no modo de comando.

Agora, ao digitar, o texto aparecerá no canto inferior esquerdo, onde antes estava escrito "INSERT". Para salvar, digitamos :w e pressionamos "Enter".

    A letra W vem da palavra "write", que significa "escrever" em inglês.

A mensagem "written" indica que as alterações foram salvas. Para sair do editor de texto, digitamos :q e pressionamos Enter, retornando ao terminal do Linux.

    A letra Q vem da palavra "quit", que significa "sair" em inglês.

Já entendemos o que é um script e criamos as primeiras linhas de código. Na sequência, aprenderemos como executar nosso script.